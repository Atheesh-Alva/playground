name: Playground - Build Page Workflow Action

on:
    push:
      tags:
      - 'Build-+[0-9]+[0-9]+[0-9]'

permissions:
  contents: read
  pages: write
  id-token: write
           
jobs:
  build:
    name: Build Page Playground CI/CD
    env:
      my_secret: ${{ github.token }}
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: https://github.com/Atheesh-Alva/playground.git

    steps:
      - name: 'Checkout Code' 
        uses: actions/checkout@v3

      - name: 'Setup Flutter'
        uses: subosito/flutter-action@v2
        with:
            channel: 'stable'    
            flutter-version: '3.22.0'
            cache: true
    
      - name: 'Enable Flutter for Web' 
        run: flutter config --enable-web

      - name: 'Flutter Pub Get' 
        run: flutter pub get

      - name: 'Build Web Release' 
        run: flutter build web --release

      - name: 'Upload Pages Artifact'
        uses: actions/upload-pages-artifact@v2
        with:
          path: build/web/

      - name: 'Deploy to GitHub Pages'
        id: deployment
        uses: actions/deploy-pages@v2